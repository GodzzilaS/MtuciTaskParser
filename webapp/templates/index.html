{% extends 'base.html' %}
{% block title %}–û—Å–Ω–æ–≤–Ω–∞—è{% endblock %}
{% block content %}
<div class="card status-banner">
  <h2>üõ∞Ô∏è –°–æ—Å—Ç–æ—è–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã</h2>
  <div class="status-grid">
    <div class="status-item">
      <span class="status-label">–ë–æ—Ç</span>
      <span class="status-value {{ 'on' if bot_enabled else 'off' }}">
        {{ '–í–∫–ª—é—á—ë–Ω' if bot_enabled else '–í—ã–∫–ª—é—á–µ–Ω' }}
      </span>
    </div>
    <div class="status-item">
      <span class="status-label">–¢–µ—Ö. —Ä–∞–±–æ—Ç—ã</span>
      <span class="status-value {{ 'on' if maintenance_mode else 'off' }}">
        {{ '–í–∫–ª—é—á–µ–Ω—ã' if maintenance_mode else '–í—ã–∫–ª—é—á–µ–Ω—ã' }}
      </span>
    </div>
    <div class="status-item">
      <span class="status-label">–ü—Ä–æ–≤–µ—Ä–∫–∏</span><br>
      <span class="status-label">
        –¢–µ–∫—É—â–∏–π –∏–Ω—Ç–µ—Ä–≤–∞–ª: <strong>{{ interval }} –º–∏–Ω</strong>
      </span>
      <span class="status-value {{ 'on' if scheduled_enabled else 'off' }}">
        {{ '–í–∫–ª—é—á–µ–Ω—ã' if scheduled_enabled else '–û—Ç–∫–ª—é—á–µ–Ω—ã' }}
      </span>
    </div>
  </div>
</div>

<div class="card">
  <h2>‚öô –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</h2>
  <div class="button-panel">
    <a href="{{ url_for('main.toggle_bot') }}" class="menu-item">
      {{ '–í—ã–∫–ª—é—á–∏—Ç—å –±–æ—Ç–∞' if bot_enabled else '–í–∫–ª—é—á–∏—Ç—å –±–æ—Ç–∞' }}
    </a>
    <a href="{{ url_for('main.toggle_maintenance') }}" class="menu-item">
      {{ '–í—ã–∫–ª—é—á–∏—Ç—å —Ç–µ—Ö.—Ä–∞–±–æ—Ç—ã' if maintenance_mode else '–í–∫–ª—é—á–∏—Ç—å —Ç–µ—Ö.—Ä–∞–±–æ—Ç—ã' }}
    </a>
    <a href="{{ url_for('main.toggle_scheduled') }}" class="menu-item">
      {{ '–û—Ç–∫–ª—é—á–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫–∏' if scheduled_enabled else '–í–∫–ª—é—á–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫–∏' }}
    </a>
    <form action="{{ url_for('check.run_check') }}" method="post" class="menu-item">
      <button type="submit" class="form-menu-item">
        –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É
      </button>
    </form>
  </div>
</div>

<div class="card stats-card">
  <h2>üìä –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h2>
  <div class="stats-grid">
    <div class="stat">
      <span class="stat-label">–í—Å–µ–≥–æ –ø—Ä–æ–≤–µ—Ä–æ–∫</span>
      <span class="stat-value">{{ total_schedule }}</span>
    </div>

    <div class="stat">
      <span class="stat-label">–ü–æ—Å–ª–µ–¥–Ω—è—è –ø—Ä–æ–≤–µ—Ä–∫–∞</span>
      <span class="stat-value">{{ last_schedule or '‚Äî' }}</span>
    </div>

    <div class="stat">
      <span class="stat-label">–ó–∞–ø—É—Å–∫–æ–≤ –¥—Ä–∞–π–≤–µ—Ä–∞</span>
      <span class="stat-value">{{ driver_inits }}</span>
    </div>

    <div class="stat">
      <span class="stat-label">–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–π –Ω–∞ LMS</span>
      <span class="stat-value">{{ authorizations }}</span>
    </div>

    <div class="stat">
      <span class="stat-label">–£—Å–ø–µ—à–Ω—ã—Ö –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–π –Ω–∞ LMS</span>
      <span class="stat-value">{{ success_authorizations }}</span>
    </div>

    <div class="stat">
      <span class="stat-label">–ù–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</span>
      <span class="stat-value">{{ new_users }}</span>
    </div>

    <div class="stat stat-full">
      <span class="stat-label">üìà –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ</span>
      <div class="command-table">
        <div class="command-row command-head">
          <div>–ö–æ–º–∞–Ω–¥–∞</div>
          <div>–ö–æ–ª-–≤–æ</div>
          <div>–ü–æ—Å–ª–µ–¥–Ω–µ–µ</div>
          <div class="aligned-times">
            <div>–ú–∏–Ω</div>
            <div>–°—Ä</div>
            <div>–ú–∞–∫—Å</div>
            <div>–ü–æ—Å–ª</div>
          </div>
        </div>
        {% for cmd, data in commands_data.items() %}
        <div class="command-row">
          <div><code>{{ cmd }}</code></div>
          <div>{{ data.count }}</div>
          <div class="dim">{{ data.last or '‚Äî' }}</div>
          <div class="aligned-times">
            {% if command_stats.get(cmd) %}
            <div>{{ command_stats[cmd].min }}</div>
            <div>{{ command_stats[cmd].avg }}</div>
            <div>{{ command_stats[cmd].max }}</div>
            <div>{{ command_stats[cmd].last_duration }}</div>
            {% else %}
            <div>‚Äî</div>
            <div>‚Äî</div>
            <div>‚Äî</div>
            <div>‚Äî</div>
            {% endif %}
          </div>
        </div>
        {% endfor %}
      </div>
    </div>
  </div>
</div>
{% endblock %}